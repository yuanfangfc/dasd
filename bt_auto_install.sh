#!/usr/bin/env bash

# ==========================================================
# 🚀 Ubuntu 20.x 全自动安装宝塔面板（免交互）
# 🧾 作者: 专业代码助理 GPT
# 💡 适配环境: Ubuntu 20.04+
# ==========================================================

# ------------------------------
# 1️⃣ 定义颜色输出函数
# ------------------------------
print_info() {
    echo -e "\033[1;32m[INFO]\033[0m $1"
}

print_error() {
    echo -e "\033[1;31m[ERROR]\033[0m $1"
}

# ------------------------------
# 2️⃣ 检查是否为 root 用户
# ------------------------------
if [ "$(id -u)" -ne 0 ]; then
    print_error "请使用 root 用户运行此脚本！"
    exit 1
fi

# ------------------------------
# 3️⃣ 更新系统包索引
# ------------------------------
print_info "更新系统软件包索引..."
apt update -y

# ------------------------------
# 4️⃣ 安装 curl/wget（若未安装）
# ------------------------------
print_info "检查并安装 curl 和 wget..."
apt install -y curl wget sudo lsb-release

# ------------------------------
# 5️⃣ 设置 DEBIAN_FRONTEND 以避免交互
# ------------------------------
export DEBIAN_FRONTEND=noninteractive

# ------------------------------
# 6️⃣ 启动宝塔官方安装（自动确认）
# ------------------------------
print_info "开始安装宝塔面板..."
# 官方安装命令，末尾追加 -y 参数或自动输入 echo y
# 这里用 curl 安装脚本后自动执行
curl -sSO http://download.bt.cn/install/install_ubuntu.sh

# 使用 echo y | bash 方式实现自动同意
echo y | bash install_ubuntu.sh

# ------------------------------
# 7️⃣ 清理临时文件
# ------------------------------
rm -f install_ubuntu.sh

# ------------------------------
# 8️⃣ 安装完成提示
# ------------------------------
print_info "宝塔面板安装已完成，请根据输出信息访问面板 URL 登录！"
